---
output: html_document
editor_options: 
  chunk_output_type: console
---
# The PFP Field Experiments
<div style="text-align: center;">
![](./images/chapter_5_header.jpg)
</div>


## Procedure
### Planting {-}
<div style="text-align: center;">
![A traditional Hopi planting stick, or 'soya'.](./images/chapter_6_soya.jpg)
</div>

The primary tool for planting is a planting stick or, in the Hopi language, a soya. Traditionally a soya is made from of greasewood (Sarcobatus vermicalatus), but some planting sticks today are made from a length of metal pipe with a narrow blade welded to one end. 

Planting begins by using your foot to scrape away the upper layer of loose, dry dirt. This exposes the top of the underlying hard-packed soil. About a square foot area is cleared. The planter gets down on one knee and grabs the soya with one hand low and one hand higher up on the tool. A narrow hole is dug using a pulling motion toward the planter.  Typically, the hole is dug to a depth of about 8 to 10 inches or to the point where good soil moisture is encountered.  The hole is dug deeper if the soil is drier and shallower if the soil is moist.  This soil moisture is critical for plant germination and for the plant to be able to grow until there is more precipitation, something that might not occur until many weeks after planting. 

Hopi farmers plant corn in clumps. About 10-20 seeds are deposited into the hole. The excavated earth is put back gently into the hole in the order it was removed, the moist soil covering the seeds on the bottom and the drier soil on top. The loose dry dirt is on the top, but a small basin is created on the surface to collect any precipitation that falls and to create a dust mulch that reduces evaporation. 

The farmer stands and takes two or three steps to measure where the next clump of corn will be planted. Because the soils in the PFP gardens hold a bit more moisture than those soils near the Hopi mesas, the PFP clumps are typically spaced about 1.5- 1.75 meters apart rather than the three-meter spacing typically used at Hopi. The wide spacing of the planted clumps reduces competition for valuable sub-surface moisture. When the garden planting has been completed the farmers call out "kwakwhay", thank you!

Flick through these slides to see how planting is done the Hopi way! The descriptions are based on *Notes On Hopi Economic Life* by Earnest Beaglehole, 1937.

<div class="carousel">
![1. The planter scrapes away the loose dirt to clear the surface.](./images/planting/1_planting.jpg)
![2. The planter drops to one knee and with a few strokes of the digging stick begins to create a narrow trough–like hole.](./images/planting/2_planting.jpg)
![3. Traditional digging sticks (So’ya) are made from greasewood and oak. Modern planting tools are made from pipe.](./images/planting/3_planting.jpg)
![4. The hole is dug eight to twelve inches deep where the moist subsoil is located. Deep planting takes advantage of the moisture in the soil for germination and allows the plants to develop a deep root system.](./images/planting/4_planting.jpg)
![5. The moist soil at the bottom of the hole is loosened.](./images/planting/5_planting.jpg)
![6. Ten to sixteen seeds are deposited into the hole. Many seedlings planted close together provides protection from the harsh sun and wind. It also reduces the  possibility of a total loss from insects, birds and other animals.](./images/planting/6_planting.jpg)
![7. The soil around the sides of the hole is loosened, then the hole in filled in with the moist soil that was removed  from the  bottom of the hole going back in first. The soil is then packed down.](./images/planting/7_planting.jpg)
![8. Two to three paces (1.5 to 2 meters) are measured off between plantings. Red pin flags mark spacing.](./images/planting/8_planting.jpg)
![9. Wide spacing allows adequate room for roots to absorb moisture from the soil.](./images/planting/9_planting.jpg)
</div>

<div class="carcaption">
<p class="caption">&nbsp;</p>
</div>

### Monitoring {-}
<div style="text-align: center;">
![Paul Ermigiotti records the growth of maize in the Check Dam Garden.](./images/chapter_3_header.jpg)
</div>

The procedures for monitoring the gardens were based on those developed by Benjamin Bellorado in an experimental gardening study that he developed for the Animas-LaPlata archaeological project and for his MA thesis at Northern Arizona University. For the majority of the PFP these procedures were implemented by Paul Ermigiotti and staff and volunteers who assisted him.

Monitoring was conducted each week. The primary objective was to record growth stages, to document damage by pests, and to make other observations about the condition of the gardens.  The data were recorded on paper forms in the field and input into a database at a later time.

The data collected each week on growth stages includes the following:

* **Height** --- The height of the tallest plant in each clump was recorded to the nearest 5 cm.
* **Early Tassel Development** --- Early tassel development was recorded when it occurred on any plant in   a clump. Early tassel development is defined as the time when the tassel bud starts to emerge from the central enclosing leaves at the top of the stalk to the time the tassel spike begins to branch.
* **Tassel Development** --- Tassel development was recorded each week when it occurred on any plant in a clump. Tassel development is defined from time when the tassel emerges from the central cluster of leaves and begins to branch. This stage ends when the anthers (male flowers) emerge from the glumes of the tassel and the pollen begins to shed.
* **Tasseling** --- The period of tasseling was recorded for when it occurred on any plant in a clump. The tasseling period is defined when the apex inflorescences (a group of flowers) begins to open. The anthers (male flowers) emerge and begin to shed pollen. At this stage the stalk has produced all its leaves and the plant has reached full height.
* **Silk Development** --- Silk development was recorded when it occurred on any plant in a clump. Silk development is defined when ear shoots become visible in the nodes (between the leaf and stalk) until the silks have fully emerged and are ready to receive pollen.
* **Silking** --- Silk development was recorded when it occurred on any plant in a clump.  Silking is defined when the silk has emerged from the husk surrounding the developing cob and is capable of receiving pollen. A single silk will deliver pollen and develop into individual kernel. Once the silks have begun to dry and shrivel, this growth stage has ended.
* **Ear Development** --- Ear development was recorded when it occurred on  any plant in  a clump.  Ear development is defined as once the silks have dried out, shriveled, and are no longer accepting pollen, and continues until the kernels mature and the ear is ready to harvest.  A hard frost (below 28 ° F.) will prematurely end ear development.


### Harvesting {-}
<div style="text-align: center;">
![Harvesting maize.](./images/chapter_5_harvest.jpg)
</div>

The harvest and yield data entry for the Pueblo Farming Project is a three step process that includes collecting the corn from the field, weighing  the ears just after harvest, then, when the ears have completely dried, they are weighed again to enter the dry kernel weight for each ear.

On harvest day, typically in mid-October, after the ears have sufficiently ripened on the stalk, the farmers approach the garden with anticipation. All of the ears from each stalk in a clump are shucked, the silk removed and the ears are recorded and tagged according to the clump, stalk and ear. After the ears are collected from a clump the stalks are bent over at the base and laid to rest on the ground. This laying to rest of the stalks is part of the life process that cycle through birth, maturation and death. The stalks left in the garden also help with the spacing in the next year's planting. Planting in between the stalks ensure that seeds are not planted in the same place two years in a row.

<div style="text-align: center;">
![Harvesting maize, and recording its attributes](./images/harvesting.jpg)
</div>

After harvest the ears are weighed to obtain a "wet weight" as there is still considerable moisture remaining in the ears. The ears are the placed on trays and allowed to dry for two months.

When the ears have thoroughly dried, each ear is weighed whole, and then with the kernels removed.  Ear, cob and kernel weights are entered into the data base. Additional information on the ear is also recorded such as the number of rows of kernels, kernel color, and the completeness of kernel filling on the ear. The categories, or condition of the ear are: 

* Full --- more than two-thirds of the kernels present
* Partial --- one-third to two-thirds of the kernels are present
* Sparse --- up to one-third of the kernels are present, and
* Immature --- there are no kernels present on the cob.

## Results
<div style="text-align: center;">
![Paul Ermigiotti displaying a large ear of corn during harvest.](./images/section_5.2_header.jpg)
</div>

```{r pfp-results, echo=FALSE, warning=FALSE, message=FALSE}
library(plotly)
library(magrittr)

gardens <- readr::read_csv("./data/gardens.csv")
growth <- readr::read_csv("./data/growth.csv")
growth_summaries <- readr::read_csv("./data/growth_summaries.csv")
ears <- readr::read_csv("./data/ears.csv")
yields <- readr::read_csv("./data/yields.csv")

dir.create("./docs/plots",
           showWarnings = FALSE,
           recursive = TRUE)

dir.create("./docs/tables",
           showWarnings = FALSE,
           recursive = TRUE)

tabler <- function(x, file_out){
  out <- x %>%
    dplyr::mutate_if(is.double, ~round(., digits = 3)) %>%
    DT::datatable(extensions = c('FixedColumns','Buttons'),
                  options = list(
                    dom = 'Bfrtip',
                    scrollX = TRUE,
                    fixedColumns = list(leftColumns = 1),
                    pageLength = 5,
                    buttons = list('csv', 
                                   'print', 
                                   list(extend = 'print',
                                        autoPrint = FALSE))),
                  rownames = FALSE,
                  width = "100%",
                  height = "100%") %T>%
    htmlwidgets::saveWidget(file = file_out,
                            selfcontained = TRUE,
                            libdir = "./libs")
  
  out %>%
    htmlwidgets:::toHTML() %>%
    htmltools::save_html(file = file_out,
                         libdir = "./libs")
  
  file.copy(file_out,
            stringr::str_c("./docs/tables/",file_out),
            overwrite = TRUE)
  
  unlink(file_out)
  
  system("cp -R libs/. docs/tables/libs/")
}

```

PFP researchers were interested in how much Hopi maize could be grown in the Mesa Verde region, and whether the **phenotype**---or physical charactistics---of Hopi maize grown in the Mesa Verde region would be different from that grown on the Hopi Mesas. Here, we present analyses of [maize growth][Maize growth] (the **phenology** of maize), [maize yield][Maize yield], and [ear diversity][Ear diversity] (phenotype).

### Maize growth {-}
**The timing of maize growth stages was variable across the PFP gardens.** The data and graph below report the growth data for each of the gardens for every year of the PFP. Because the different clumps of maize (and even maize plants within a clump) mature at different rates, PFP researchers report the proportion of clumps that have reached a given growth stage. So for example, in the table below, a "tasseling" proportion of `r growth_summaries %>% dplyr::filter(Garden == "CDG", Date == "2009-08-06") %$% Tasseling %>% round(digits = 3)` in the Check Dam Garden (CDG) on August 6, 2009, means that `r growth_summaries %>% dplyr::filter(Garden == "CDG", Date == "2009-08-06") %$% Tasseling %>% round(digits = 3) %>% magrittr::multiply_by(100)`% of clumps in the CDG showed signs of tasseling by that date. The data presented below are a summary of the raw growth data, which are available <a href="./docs/tables/growth_table.csv" download="PFP_growth_table.csv">here</a>.

```{r growth-summary-data, echo=FALSE, warning=FALSE, message=FALSE}
growth_summaries %>%
  tabler("growth_summary_table.html")

growth %>%
  readr::write_csv("./docs/tables/growth_table.csv")
```

<iframe src="./tables/growth_summary_table.html" width="100%" height="500px" frameborder="0" scrolling="no"></iframe>

An important thing to consider is the timing of tasseling relative to silking. The tassels of maize plants are their flowers---they produce pollen that must fall upon silks in order to produce maize kernels. If tasseling and silking don't happen at nearly the same time, pollenation doesn't occur, and the ears won't develop. If tasseling happens long before silking, the pollen will fall to the ground. The graph below allows you to select a year and visualize the relative timing of tasseling and silking (and the other growth stages). You'll notice that the highest yielding gardens like the Check Dam Garden (CDG) have silk development and silking occur within about a week after tasseling. In other gardens, like Karen's Upper Garden (KUG), silking follows many weeks after tasseling; this prevents a majority of pollenation and leads to lower yields in that garden.

**Explore the plot below.** You can hover over the plot to view the individual values. Use the slider at the bottom of the graph to move throught he growth stages. You can isolate a particular garden by double clicking its name in the legend at the right of the graph; a single click will turn a garden on or off. Finally, you can download an image of the graph by hovering over it and clicking the small camera icon in the upper right.

```{r growth-plot, echo=FALSE, warning=FALSE, message=FALSE}
2009:2017 %>%
  magrittr::set_names(2009:2017) %>%
  purrr::walk(function(season){
    test_data <- growth_summaries %>%
      tidyr::gather(`Growth stage`, 
                    `Proportion of clumps at growth stage`, 
                    `Early Tassel Development`:`Ear Development`) %>%
      dplyr::mutate(`Growth stage` = ordered(`Growth stage`, 
                                             levels = c("Early Tassel Development",
                                                        "Tassel Development",
                                                        "Tasseling",
                                                        "Silk Development",
                                                        "Silking",
                                                        "Ear Development"
                                             ))) %>%
      dplyr::filter(Season == season)
    
    out <-  test_data %>%
      plot_ly(
        x = ~Date, 
        y = ~`Proportion of clumps at growth stage`, 
        frame = ~`Growth stage`,
        color = ~Garden#,
        # width = 800,
        # height = 400
      ) %>% 
      add_lines() %>%
      animation_opts(
        transition = 0,
        redraw = FALSE
      ) %>% 
      animation_slider(
        currentvalue = list(prefix = "", 
                            font = list(size = 12,
                                        color = "black")),
        font = list(size = 8,
                    color = "black")
      ) %>%
      animation_button(visible = FALSE,
                       x = 1, xanchor = "right", y = 0, yanchor = "bottom"
      ) %>%
      layout(xaxis = list(title = "",
                          range = range(test_data$Date) %>%
                            as.POSIXct(format="%Y-%m-%d") %>%
                            as.numeric() %>%
                            magrittr::multiply_by(1000),
                          type = "date"),
             yaxis = list(title = "Proportion of clumps\nat growth stage")
      ) %>%
      config(displaylogo = F,
             scrollZoom = F,
             collaborate = FALSE,
             modeBarButtonsToRemove = list("toggleSpikelines",
                                           "hoverClosestCartesian",
                                           "hoverCompareCartesian",
                                           "resetScale2d")) %T>%
      htmlwidgets::saveWidget(file = stringr::str_c("./growth_",season,".html"),
                              selfcontained = FALSE,
                              libdir = "./libs")
    
    out %>%
      htmlwidgets:::toHTML() %>%
      htmltools::save_html(file = stringr::str_c("./growth_",season,".html"), 
                           libdir = "./libs")
    
    file.copy(stringr::str_c("./growth_",season,".html"),
              stringr::str_c("./docs/plots/growth_",season,".html"),
              overwrite = TRUE)
    
    unlink(stringr::str_c("./growth_",season,".html"))
    
  })

system("cp -R libs/. docs/plots/libs/")

```


<form name="change">
<select name="options" onchange="document.getElementById('youriframe').src = this.options[this.selectedIndex].value">
<option value="./plots/growth_2017.html">Select a year to view the growth data:</option>
<option value="./plots/growth_2017.html">2017</option>
<option value="./plots/growth_2016.html">2016</option>
<option value="./plots/growth_2015.html">2015</option>
<option value="./plots/growth_2014.html">2014</option>
<option value="./plots/growth_2013.html">2013</option>
<option value="./plots/growth_2012.html">2012</option>
<option value="./plots/growth_2011.html">2011</option>
<option value="./plots/growth_2010.html">2010</option>
<option value="./plots/growth_2009.html">2009</option>
</select>

<iframe name="iframe" id="youriframe" src="./plots/growth_2017.html" height="400" width="100%" frameborder="0" scrolling="no"></iframe>

### Maize yield {-}
```{r yield-summary-data, echo=FALSE, warning=FALSE, message=FALSE}
yields_summary <- yields %>%
  dplyr::group_by(Season,Garden,Variety) %>%
  dplyr::summarise(`PFP experimental yield (kg/ha)` = mean(`PFP experimental yield (kg/ha)`)) %>%
  dplyr::mutate(`PFP experimental yield (kg/ha)` = round(`PFP experimental yield (kg/ha)`)) %T>%
  tabler("yield_summary_table.html")

max_yield <- yields_summary %>% 
  dplyr::ungroup() %>%
  dplyr::filter(`PFP experimental yield (kg/ha)` == max(`PFP experimental yield (kg/ha)`, na.rm = TRUE))

yields %>%
  readr::write_csv("./docs/tables/yield_table.csv")
```

**Hopi maize grown during the PFP flourished in the Mesa Verde region.** Although some gardens failed to produce yields in some years, many of the gardens produced substantial yields. The highest yielding garden was the `r max_yield$Garden` garden in `r max_yield$Season`, which produced an average yield of `r max_yield[["PFP experimental yield (kg/ha)"]]` kg/ha of maize. To put that into perspective, such a yield rate would have easily supported `r (max_yield[["PFP experimental yield (kg/ha)"]]/160) %>% floor()` people! The average yield over all of the gardens from 2009--2017 was `r (yields_summary[["PFP experimental yield (kg/ha)"]]) %>% mean() %>% round()` kg/ha, enough for about two people. The data presented above are a summary of the raw yield data, which are available <a href="./docs/tables/yield_table.csv" download="PFP_yield_table.csv">here</a>.

<iframe src="./tables/yield_summary_table.html" width="100%" height="500px" frameborder="0" scrolling="no"></iframe>

Even though there were really good years with high yields in some gardens, many gardens produced very low yields (although see [What we learned] for a discussion of low yields). The graph below displays estimated yields from each garden in each year. The yields are displayed as box plots; they show the **distribution** of possible yields as calculated from the clump data (see @Bocinsky2017 for a discussion of our methods). As above, you can isolate a garden by double-clicking its name in the legend at the right of the graph. 

```{r yield-plot, echo=FALSE, warning=FALSE, message=FALSE}
out <- yields %>%
  plot_ly(x = ~Season, y = ~`PFP experimental yield (kg/ha)`, color = ~Garden, type = "box") %>%
  layout(boxmode = "group") %>%
  layout(xaxis = list(title = ""),
         yaxis = list(title = "PFP experimental yield (kg/ha)")
  ) %>%
  config(displaylogo = F,
         scrollZoom = F,
         collaborate = FALSE,
         modeBarButtonsToRemove = list("toggleSpikelines",
                                       "hoverClosestCartesian",
                                       "hoverCompareCartesian",
                                       "resetScale2d")) %T>%
  htmlwidgets::saveWidget(file = stringr::str_c("./yields_plot.html"),
                          selfcontained = FALSE,
                          libdir = "./libs")

out %>%
  htmlwidgets:::toHTML() %>%
  htmltools::save_html(file = stringr::str_c("./yields_plot.html"), 
                       libdir = "./libs")

file.copy(stringr::str_c("./yields_plot.html"),
          stringr::str_c("./docs/plots/yields_plot.html"),
          overwrite = TRUE)

unlink(stringr::str_c("./yields_plot.html"))

system("cp -R libs/. docs/plots/libs/")
```

<iframe src="./plots/yields_plot.html" width="100%" height="500px" frameborder="0" scrolling="no"></iframe>

#### Ear diversity {-}

```{r ear-data, echo=FALSE, warning=FALSE, message=FALSE}
ears %>%
  tabler("ear_table.html")
```

<iframe src="./tables/ear_table.html" width="100%" height="500px" frameborder="0" scrolling="no"></iframe>

```{r ear-summary-data, echo=FALSE, warning=FALSE, message=FALSE}
ears %>%
  dplyr::group_by(Season,Garden, Variety) %>%
  dplyr::summarise(`Median Rows` = median(Rows, na.rm = TRUE),
                   `Avg. Ear weight` = mean(`Ear weight`, na.rm = TRUE),
                   `Avg. Cob weight` = mean(`Cob weight`, na.rm = TRUE),
                   `Avg. Kernel weight` = mean(`Kernel weight`, na.rm = TRUE)) %>%
  tabler("ear_summary_table.html")
```

<iframe src="./tables/ear_summary_table.html" width="100%" height="500px" frameborder="0" scrolling="no"></iframe>

```{r ears-plot, echo=FALSE, warning=FALSE, message=FALSE}
c("rows" = "Rows",
  "ear_weight" = "Ear weight",
  "cob_weight" = "Cob weight",
  "kernel_weight" = "Kernel weight") %>%
  purrr::map(function(var){
    out <- plot_ly(x = ears$Season, 
                       y = ears[[var]], 
                       color = ears$Garden, 
                       type = "box") %>%
      layout(boxmode = "group") %>%
      layout(xaxis = list(title = ""),
             yaxis = list(title = var)
      ) %>%
      config(displaylogo = F,
             scrollZoom = F,
             collaborate = FALSE,
             modeBarButtonsToRemove = list("toggleSpikelines",
                                           "hoverClosestCartesian",
                                           "hoverCompareCartesian",
                                           "resetScale2d"))
  }) %>%
  purrr::iwalk(function(x,name){
    out <- x %T>%
      htmlwidgets::saveWidget(file = stringr::str_c("./ears_",name,"_plot.html"),
                              selfcontained = FALSE,
                              libdir = "./libs")
    
    out %>%
      htmlwidgets:::toHTML() %>%
      htmltools::save_html(file = stringr::str_c("./ears_",name,"_plot.html"), 
                           libdir = "./libs")
    
    file.copy(stringr::str_c("./ears_",name,"_plot.html"),
              stringr::str_c("./docs/plots/ears_",name,"_plot.html"),
              overwrite = TRUE)
    
    unlink(stringr::str_c("./ears_",name,"_plot.html"))
  })

system("cp -R libs/. docs/plots/libs/")

```


<form name="change">
<select name="options" onchange="document.getElementById('ears').src = this.options[this.selectedIndex].value">
<option value="./plots/ears_rows_plot.html">Select a variable to view the ear data:</option>
<option value="./plots/ears_rows_plot.html">Rows</option>
<option value="./plots/ears_ear_weight_plot.html">Ear weight</option>
<option value="./plots/ears_cob_weight_plot.html">Cob weight</option>
<option value="./plots/ears_kernel_weight_plot.html">Kernel weight</option>
</select>

<iframe name="iframe" id="ears" src="./plots/ears_rows_plot.html" height="400" width="100%" frameborder="0" scrolling="no"></iframe>


### Maize genetics {-}
Hopi communities have been cultivating maize for millennia, with very little interruption by western methods or contemporary industrialized agriculture compared to other Native American groups. As part of the PFP, researchers performed a genetics study characterizes 95 individual plants from 16 named varieties grown by 6 farmers from across the Hopi Mesas (in situ Hopi) to provide a genetic baseline for Hopi corn today. Kelly Swarts, currently a postdoctoral scholar at the Max Planck Institute for Developmental Biology in Tübingen, Germany, directed the analysis of these 95 plants and compared the results with previously published genotypes in order to contextualize Hopi genetic variation in a global context. The comparative data include ancestral Puebloan maize from the site of Turkey Pen Shelter in southern Utah which dates to c. AD 200; a collection of wild-collected teosinte; and landraces, including Hopi accessions (ex situ Hopi), from across the Americas held in collections at the USDA Agricultural Research Service and Native Seeds/SEARCH (a non-profit seed-saving organization in Arizona).

#### Results {-}

* In situ Hopi maize is genetically unique, though very closely related to other temperate maize from the southwest US.
Hopi varieties differ from other maize with respect to environmental responses, growth, and physiology.
* Ancestral Puebloan samples from Turkey Pen Shelter are closely associated with the in situ Hopi samples (as to other samples from the temperate SW US), but in situ Hopi maize has undergone continued selection for desirable traits over the last 2,000 years.
* Hopi material from the ex situ collections demonstrates tropical traits that are not found in the in situ Hopi samples from this study. The cause of this is inconclusive, but demonstrates the necessity of further not relying solely on banked-corn from services like USDA-ARS and Native Seeds/SEARCH. Analysis on Hopi maize should be performed from new in situ collections.
* Named varieties of Hopi corn are genetically different from one another, although there is a fair amount of genetic overlap between them as well. This suggests that, although contemporary Hopi farming techniques seek to isolate named types, genetic mixing has occurred in the past. 
* There is little population structure within the Hopi germplasm (variation is widely distributed), despite the clear morphological and physiological characteristics of the different varieties. This pattern typically results from past intermating between varieties, and also supports seed sharing between farmers and across the various Hopi Mesas.
* Breeding population sizes, as indicated by estimated inbreeding within populations, are within the healthy range.

These data will all be available for future studies to monitor changes within in situ Hopi germplasm.
